#
Simple RAG Application.
Exposes 2 endpoints.
One to upload documents and another one to search in the documents.

# How to build
cd docker/rag_app
docker compose build --no-cache
docker compose up

# Dev 
To work locally launch the docker-compose
poetry run env APP_ENV=.env.local app
# Test

to verify if the LLM reply use:
curl -N -i -X POST http://localhost:8000/api/invoke \
  -H "Content-Type: application/json" \
  -H "X-Thread-Id: 01" \
  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI4MDY5OTdmZC1iZDAwLTQ2YTYtOGUxZS1mNDk2ODMzZTIzZWIiLCJhdWQiOiJhdXRoZW50aWNhdGVkIiwiZXhwIjoxNzU3MDEyMzY2LCJpYXQiOjE3NTcwMDg3NjYsImVtYWlsIjoiZmVkZS5jb25vY2kud29ya0BnbWFpbC5jb20iLCJwaG9uZSI6IiIsImFwcF9tZXRhZGF0YSI6eyJwcm92aWRlciI6ImVtYWlsIiwicHJvdmlkZXJzIjpbImVtYWlsIl19LCJ1c2VyX21ldGFkYXRhIjp7ImVtYWlsIjoiZmVkZS5jb25vY2kud29ya0BnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwicGhvbmVfdmVyaWZpZWQiOmZhbHNlLCJzdWIiOiI4MDY5OTdmZC1iZDAwLTQ2YTYtOGUxZS1mNDk2ODMzZTIzZWIifSwicm9sZSI6ImF1dGhlbnRpY2F0ZWQiLCJhYWwiOiJhYWwxIiwiYW1yIjpbeyJtZXRob2QiOiJwYXNzd29yZCIsInRpbWVzdGFtcCI6MTc1NzAwODc2Nn1dLCJzZXNzaW9uX2lkIjoiMWVlYzY1NjctM2E0MC00ZDYzLWEzZjktOTAyMzU1OGY0YmFhIiwiaXNfYW5vbnltb3VzIjpmYWxzZX0.IivCfUQOIA1b2zXFjD26iCylwyccIREvSl9MsO4M0LQ' \
  -d '{"content": "search for the word ISEE in my documents"}'


to test the document upload:
curl --location 'http://localhost:8000/api/upload' \
-H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIyYjljOThkNi1jZDM4LTQxYTAtOWVkNi0wNDc1NDNjMDYwM2UiLCJhdWQiOiJhdXRoZW50aWNhdGVkIiwiZXhwIjoxNzU3MDAzNzQ3LCJpYXQiOjE3NTcwMDAxNDcsImVtYWlsIjoiZmVkZS5jb25vY2kud29ya0BnbWFpbC5jb20iLCJwaG9uZSI6IiIsImFwcF9tZXRhZGF0YSI6eyJwcm92aWRlciI6ImVtYWlsIiwicHJvdmlkZXJzIjpbImVtYWlsIl19LCJ1c2VyX21ldGFkYXRhIjp7ImVtYWlsIjoiZmVkZS5jb25vY2kud29ya0BnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwicGhvbmVfdmVyaWZpZWQiOmZhbHNlLCJzdWIiOiIyYjljOThkNi1jZDM4LTQxYTAtOWVkNi0wNDc1NDNjMDYwM2UifSwicm9sZSI6ImF1dGhlbnRpY2F0ZWQiLCJhYWwiOiJhYWwxIiwiYW1yIjpbeyJtZXRob2QiOiJwYXNzd29yZCIsInRpbWVzdGFtcCI6MTc1NzAwMDE0N31dLCJzZXNzaW9uX2lkIjoiMTIxZTI1YTMtMzlmZC00M2RiLTk4YjItNGY5ZTI5MTY4YmM2IiwiaXNfYW5vbnltb3VzIjpmYWxzZX0.sKj9iYa8YI1Auc8E_IgQgShL9mZHMpDm3U0D2i8pEg0' \
--form 'file=@"/Users/federicoconoci/Downloads/ISEE 2025 Conoci Costanzo.pdf"'

curl --location -X GET 'http://localhost:8000/api/get_user_thread' \
-H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI4MDY5OTdmZC1iZDAwLTQ2YTYtOGUxZS1mNDk2ODMzZTIzZWIiLCJhdWQiOiJhdXRoZW50aWNhdGVkIiwiZXhwIjoxNzU3MDEyMzY2LCJpYXQiOjE3NTcwMDg3NjYsImVtYWlsIjoiZmVkZS5jb25vY2kud29ya0BnbWFpbC5jb20iLCJwaG9uZSI6IiIsImFwcF9tZXRhZGF0YSI6eyJwcm92aWRlciI6ImVtYWlsIiwicHJvdmlkZXJzIjpbImVtYWlsIl19LCJ1c2VyX21ldGFkYXRhIjp7ImVtYWlsIjoiZmVkZS5jb25vY2kud29ya0BnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwicGhvbmVfdmVyaWZpZWQiOmZhbHNlLCJzdWIiOiI4MDY5OTdmZC1iZDAwLTQ2YTYtOGUxZS1mNDk2ODMzZTIzZWIifSwicm9sZSI6ImF1dGhlbnRpY2F0ZWQiLCJhYWwiOiJhYWwxIiwiYW1yIjpbeyJtZXRob2QiOiJwYXNzd29yZCIsInRpbWVzdGFtcCI6MTc1NzAwODc2Nn1dLCJzZXNzaW9uX2lkIjoiMWVlYzY1NjctM2E0MC00ZDYzLWEzZjktOTAyMzU1OGY0YmFhIiwiaXNfYW5vbnltb3VzIjpmYWxzZX0.IivCfUQOIA1b2zXFjD26iCylwyccIREvSl9MsO4M0LQ' \
-H "X-Thread-Id: 01"

curl -X DELETE "http://<your-project-ref>.supabase.co/auth/v1/admin/users/<user_id>" \
  -H "apikey: <SERVICE_ROLE_KEY>" \
  -H "Authorization: Bearer <SERVICE_ROLE_KEY>"